package com.istar.mediabroken.utils

import groovy.util.logging.Slf4j
import org.apache.http.protocol.HTTP

import java.util.regex.Matcher
import java.util.regex.Pattern;

@Slf4j
public class StringUtils {

    private static final String default_sentence_separator = "[àª¿à«€â€”ï½œğŸ»ğŸ§€ğŸŒ­=ï¼/ã€~.â—ã€Šã€‹â€œâ€ï¼ˆï¼‰(),ï¼Œâ€¦ã€‚:ï¼šï¼Ÿ?ï¼!ï¼›;\"ã€ã€‘]"

    public static String stripHtml2(String content) {
// <p>æ®µè½æ›¿æ¢ä¸ºæ¢è¡Œ
        content = content.replaceAll('<p .*?>', '\r\n');
// <br><br/>æ›¿æ¢ä¸ºæ¢è¡Œ
        content = content.replaceAll('<br\\s*/?>', '\r\n');
// å»æ‰å…¶å®ƒçš„<>ä¹‹é—´çš„ä¸œè¥¿
        content = content.replaceAll('\\<.*?>', '');
// è¿˜åŸHTML
        content = content.replaceAll('\r\n', '<br/>')
        return content;
    }


    static Pattern tagPattern = Pattern.compile(/\<.*?>/)
    static Pattern resolveTagPattern = ~/(<p .*?>)|(<br\s*\/?>)|(<\/\s*br\s*\/?>)|(<img.*\/?>)/

    public static String stripHtml(String content) {
        def matcher = tagPattern.matcher(content)
        def sb = new StringBuffer(content.length())
        while (matcher.find()) {
            def tag = matcher.group()

            if (resolveTagPattern.matcher(tag).matches()) {
                matcher.appendReplacement(sb, tag)
            } else {
                matcher.appendReplacement(sb, '')
            }
        }
        matcher.appendTail(sb)
        return sb.toString()
    }

    public static String html2text(String content) {
// <p>æ®µè½æ›¿æ¢ä¸ºæ¢è¡Œ
        content = content.replaceAll('<p .*?>', '\r\n');
// <br><br/>æ›¿æ¢ä¸ºæ¢è¡Œ
        content = content.replaceAll('<br\\s*/?>', '\r\n');
// å»æ‰å…¶å®ƒçš„<>ä¹‹é—´çš„ä¸œè¥¿
        content = content.replaceAll('\\<.*?>', '');
//æ›¿æ¢BR
        content = content.replaceAll('<br/>', '\r\n');
//æ›¿æ¢ç©ºæ ¼è½¬ä¹‰å­—ç¬¦
        content = content.replaceAll('&nbsp;', ' ');
//æ›¿æ¢@å­—ç¬¦
        content = content.replaceAll('&copy;', '@');
        //æ›¿æ¢&å­—ç¬¦
        content = content.replaceAll('&', " ");
        content = content.replaceAll('gt;', "");
        content = content.replaceAll(':', " ");
        content = content.replaceAll('\\?', " ");
        return content;
    }

    static Pattern imgTagPattern = ~/(<img.*\/?>)/
    static Pattern srcPropertyPattern = ~/src=['"](.*?)['"]/

    public static List extractImgUrl(String content) {
        def matcher = tagPattern.matcher(content)
        def list = []
        while (matcher.find()) {
            def tag = matcher.group()
            if (imgTagPattern.matcher(tag).matches()) {
                def srcMatcher = srcPropertyPattern.matcher(tag)
                if (srcMatcher.find()) {
                    list << srcMatcher.group(1)
                }
            }
        }
        return list
    }

    static Pattern tagPattern2 = Pattern.compile(/<b class='high-light'>.*?<\/b>/)

    public static Map extractHighlight(String content) {
        def matcher = tagPattern2.matcher(content)
        Map result = [:]
        while (matcher.find()) {
            String key = matcher.group()
            String value = key.substring(22, key.length() - 4)
            result.put(key, value)
        }
        return result
    }

    public static String solrHtml2text(String content) {
        content = content.trim()
        content = content.replaceAll("\\\\n", '');
        content = content.replaceAll("\\\\t", '');
        content = content.replaceAll("\\\\r", '');
        return content;
    }

    public static String solrText2Html(String content) {
        content = content.trim()
        content = content.replaceAll("\\\\r\\\\n", "<br/>");
        content = content.replaceAll("\\\\n", "<br/>");
        content = content.replaceAll("\\\\t", "  ");
        content = content.replaceAll("\\\\r", "<br/>");
        content = content.replaceAll("<br/><br/>", "<br/>");
        return content;
    }

    public static String ContentText2Html(String content) {
        content=content.replaceAll("ã€€"," ");
//        content = content.replaceAll("/", "|");
        content = content.replaceAll("\\r\\n\\r\\n", "<br>");
        content = content.replaceAll("\\r\\n", "<br>");
        content = content.replaceAll("\\n", "<br>");
        content = content.replaceAll("\\t", "ã€€");
        content = content.replaceAll("\\r", "<br>");
        content = content.replaceAll("\r", "<br>");
        content = content.replaceAll("\n", "<br>");
        content = content.replaceAll("\\>\\s*\\<", "><")
        content = content.replaceAll("(<br>)+", "<br/>")
        StringBuffer stringBuffer = new StringBuffer()
        content.split("<br/>").each {
            if(it.toString().trim()){
                stringBuffer.append("<p>")
                stringBuffer.append(it)
                stringBuffer.append("</p>")
            }
        }
        return stringBuffer.toString();
    }

    public static String Text2Html(String content) {
        content = content.trim()
        content = content.replaceAll("\\r\\n", "<br/>");
        content = content.replaceAll("\\n", "<br/>");
        content = content.replaceAll("\\t", "");
        content = content.replaceAll("\\r", "<br/>");
        content = content.replaceAll("<br/><br/>", "<br/>");
        return content;
    }

    public static String removeSpaceCode(String content) {
        content = content.trim()
        content = content.replaceAll("&#13;", "");
        content = content.replaceAll("\\<p>[ã€€]+", "<p>");
        content = content.replaceAll("\\<p>\\s*", "<p>");
        return content;
    }

    public static String illegalText2Html(String content) {
        content = content.trim()
        content = content.replaceAll("\\r\\n", "");
        content = content.replaceAll("\\n", "");
        content = content.replaceAll("\\t", "");
        content = content.replaceAll("\\r", "");
        content = content.replaceAll("<br/><br/>", "<br/>");
        return content;
    }

    /**
     * ç”¨å•ä¸ªç©ºæ ¼å­—ç¬¦æ›¿æ¢å¤šä¸ªç©ºæ ¼å­—ç¬¦
     * @param str
     * @return
     */
    public static String replaceMultipleSpace(String str){
        str = str.replaceAll("Â ", " ")
        str = str.replaceAll(" +"," ")
        return str
    }

    //åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ä»¥æ•°å­—å¼€å¤´
    public static boolean isStartWithNumber(String str) {
        if (str != null && !"".equals(str)){
            if (str.matches("[0-9]+.*")){
                return true
            }else {
                return false
            }
        }
    }

    //å»æ‰å¾®åšæ­£æ–‡åç¼€è§†é¢‘åœ°å€ http://t.cn/RrGZA5m
    public static String removeWeiboSuffix(String str) {
        try {
            if (str != null && !"".equals(str)) {
                int index = str.lastIndexOf("http://t.cn")
                if (str.length() == (index + 19)) {
                    str = str.substring(0, index)
                } else {
                    str = str.substring(0, index) + str.substring(index + 19, str.length())
                }
            }
        }catch (IndexOutOfBoundsException e){
            return str
        }
        return str
    }


    public static String decodeStr(String source) {
        def resultStr = ""
        if (source) {
            if (source.contains("%")) {
                try {
                    resultStr = URLDecoder.decode(source, HTTP.UTF_8)
                } catch (UnsupportedEncodingException e) {
                    log.error("decode exception ::: {}", e)
                }
            } else {
                resultStr = source
            }
        }
        return resultStr
    }

    public static String encodeStr(String source) {
        try {
            if (source) {
                return URLEncoder.encode(source, HTTP.UTF_8)
            } else {
                return ''
            }
        } catch (UnsupportedEncodingException e) {
            log.error("encode exception ::: {}", e)
        }
    }

    public static String removeSpecialCode(String str) {
        String regEx = "[\"ï¼‚`~!@#%^&*()+=|\${}':;',  ã€€ã€€\\[\\].<>/?~ï¼@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰â€”â€”+|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œâ€™ã€‚ï¼Œã€ï¼Ÿ]";
        Pattern p = Pattern.compile(regEx);
        Matcher m = p.matcher(str);
        return m.replaceAll("").trim();
    }

    //å…¨ç½‘ç›‘æ§è¡¨è¾¾å¼ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œé™¤æ‹¬å·å¤–
    public static boolean existSpecialCode(String str) {
        String regEx = "[\"ï¼‚`~!@#%^&*+=|\${}':;',,.\\[\\].<>/?~ï¼@#ï¿¥%â€¦â€¦&*â€”â€”+|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œâ€™ã€‚ï¼Œã€ï¼Ÿ]";
        Pattern p = Pattern.compile(regEx);
        Matcher m = p.matcher(str);
        return m.find();
    }

    //æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªæœ‰æ–‡æœ¬ã€æ•°å­—ã€ä¸‹åˆ’çº¿
    public static boolean isLegitimate(String str) {
        String regEx = "^\\w+\$"
        Pattern p = Pattern.compile(regEx);
        Matcher m = p.matcher(str);
        return m.matches()
    }
    //æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªæœ‰æ•°å­—ä¸­æ–‡ä¸‹åˆ’çº¿
    public static boolean isCheckName(String str) {
        String regEx = "[^(a-zA-Z0-9\\\\u4e00-\\\\u9fa5)]"
        Pattern p = Pattern.compile(regEx);
        Matcher m = p.matcher(str);
        return m.matches()
    }

    //æ£€æŸ¥å¯†ç çš„å®‰å…¨åº¦,6-18ä½ åŒ…å«æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ä¸­è‡³å°‘ä¸¤ç§
    public static boolean securityPwd(String pwd) {
        if (pwd && pwd.length() >= 6 && pwd.length() <= 18) {
            if (isLegitimate(pwd)) {
                //å¦‚æœåªåŒ…å«æ•°å­—æˆ–å­—æ¯æˆ–ä¸‹åˆ’çº¿
                String numReg = "^[0-9]+\$"
                String wordReg = "^[A-Za-z]+\$"
                String lineReg = "^[_]+\$"
                if (Pattern.compile(numReg).matcher(pwd) || Pattern.compile(wordReg).matcher(pwd) || Pattern.compile(lineReg).matcher(pwd)) {
                    return false
                } else {
                    return true
                }
            } else {
                return false
            }
        } else {
            return false
        }
    }

    /**
     * è¿‡æ»¤æ–‡æœ¬ä¸­çš„aæ ‡ç­¾
     * @param str
     * @return
     */
    public static String removeAElement(String str) {
        return str ? str.replaceAll('<a.+href[^>]*>', '').replaceAll('</a>', '') : ''
    }

    public static String isNullOrNot(String str) {
        String strRe = "";
        strRe = (str == null ? "" : html2text(str))
        return strRe
    }

    public static boolean isMobileNumber(String mobiles) {
        return Pattern.compile('^((13[0-9])|(14[0-9])|(15[0-9])|(16[0-9])|(18[0-9])|(17[0-9])|(19[0-9])|(147))\\\\d{8}$').matcher(mobiles).matches();
    }

    /**
     * åˆ‡åˆ†å¥å­
     * @param document
     * @param sentence_separator
     * @return
     */
    static Set<String> splitSentence(String document, String sentence_separator) {
        def map = [:]

        if (sentence_separator == null || sentence_separator.isEmpty()) {
            sentence_separator = default_sentence_separator
        }
        document = document.replaceAll("Â ", "\n").replaceAll("ã€€", "\n")

        for (String line : document.split("[\t\r\n]")) {
            if (line.length() == 0) continue
            for (String sent : line.split(sentence_separator)) {
                if (sent.length() == 0) continue
                for (String str : sent.split("\\s+")) {
                    if (str) {
                        map.put(str, org.apache.commons.lang3.StringUtils.deleteWhitespace(
                                str.replaceAll("Â ", "")
                        ).length())
                    }
                }
            }
        }
        def sort = map.sort { -it.value }

        def set = sort.take(3).keySet()

        return set
    }

    /**
     * javaç”Ÿæˆéšæœºæ•°å­—å’Œå­—æ¯ç»„åˆ
     * @param length[ç”Ÿæˆéšæœºæ•°çš„é•¿åº¦]
     */
    public static String getCharAndNumr(int length) {
        String val = "";
        Random random = new Random();
        for (int i = 0; i < length; i++) {
            // è¾“å‡ºå­—æ¯è¿˜æ˜¯æ•°å­—
            String charOrNum = random.nextInt(2) % 2 == 0 ? "char" : "num";
            // å­—ç¬¦ä¸²
            if ("char".equalsIgnoreCase(charOrNum)) {
                // å–å¾—å¤§å†™å­—æ¯è¿˜æ˜¯å°å†™å­—æ¯
                int choice = random.nextInt(2) % 2 == 0 ? 65 : 97;
                val += (char) (choice + random.nextInt(26));
            } else if ("num".equalsIgnoreCase(charOrNum)) { // æ•°å­—
                val += String.valueOf(random.nextInt(10));
            }
        }
        return val;
    }

    //ç”Ÿæˆword æ—¶å€™url è½¬ä¹‰
    public static String replaceSpecialWord(String str){

        if(str){
            return str.replaceAll("&","&amp;").replaceAll("<","&lt;")
            .replaceAll(">","&gt;").replaceAll("\"","&quot;").replaceAll("'","&apos;")
        }else {
            return ""
        }
    }

    public static void main(String[] args) {
        String a = "\n" +
                "      \n" +
                "åŸæ ‡é¢˜ï¼š lt;1441æœŸ æœ€é«˜äººæ°‘æ£€å¯Ÿé™¢å…³äºäººæ°‘æ£€å¯Ÿé™¢åŠ å¼ºå¯¹æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨æ³•å¾‹ç›‘ç£å·¥ä½œæƒ…å†µçš„æŠ¥å‘Š\n" +
                "            \n" +
                "æœ€é«˜äººæ°‘æ£€å¯Ÿé™¢å…³äºäººæ°‘æ£€å¯Ÿé™¢ \n" +
                "\n" +
                "åŠ å¼ºå¯¹æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨æ³•å¾‹ç›‘ç£ \n" +
                "\n" +
                "å·¥ä½œæƒ…å†µçš„æŠ¥å‘Šï¼ˆæ‘˜è¦ï¼‰ \n" +
                "\n" +
                "â€”â€”2018å¹´10æœˆ24æ—¥åœ¨ç¬¬åä¸‰å±Šå…¨å›½äººæ°‘ä»£è¡¨å¤§ä¼šå¸¸åŠ¡å§”å‘˜ä¼šç¬¬å…­æ¬¡ä¼šè®®ä¸Š \n" +
                "\n" +
                "æœ€é«˜äººæ°‘æ£€å¯Ÿé™¢æ£€å¯Ÿé•¿ã€€å¼ å†› \n" +
                "æ ¹æ®æœ¬æ¬¡ä¼šè®®å®‰æ’ï¼Œæˆ‘ä»£è¡¨æœ€é«˜äººæ°‘æ£€å¯Ÿé™¢æŠ¥å‘Šäººæ°‘æ£€å¯Ÿé™¢åŠ å¼ºå¯¹æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨æ³•å¾‹ç›‘ç£å·¥ä½œæƒ…å†µï¼Œè¯·äºˆå®¡è®®ã€‚ \n" +
                "äººæ°‘æ£€å¯Ÿé™¢ä¾æ³•å¯¹æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨å®è¡Œæ³•å¾‹ç›‘ç£ï¼Œæ˜¯ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰æ£€å¯Ÿåˆ¶åº¦çš„é‡è¦å†…å®¹ï¼Œä¹Ÿæ˜¯æˆ‘å›½å¸æ³•åˆ¶åº¦çš„é²œæ˜ç‰¹è‰²ã€‚2012å¹´æ°‘äº‹è¯‰è®¼æ³•ä¿®æ”¹ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†æ£€å¯Ÿæœºå…³æ°‘äº‹è¯‰è®¼æ³•å¾‹ç›‘ç£å†…å®¹ï¼Œå°†å®¡åˆ¤äººå‘˜è¿æ³•è¡Œä¸ºã€æ‰§è¡Œæ´»åŠ¨å’Œè°ƒè§£ä¹¦ç­‰çº³å…¥æ£€å¯Ÿç›‘ç£èŒƒå›´ï¼Œå¹¶æ–°å¢æ£€å¯Ÿå»ºè®®ã€è°ƒæŸ¥æ ¸å®ç­‰ç›‘ç£æ–¹å¼å’Œæªæ–½ï¼Œè§„èŒƒäº†å½“äº‹äººç”³è¯·ç›‘ç£çš„æ¡ä»¶ï¼Œå¯¹åŠ å¼ºæ°‘äº‹æ£€å¯Ÿå·¥ä½œæå‡ºäº†æ›´é«˜è¦æ±‚ã€‚åœ¨ä»¥ä¹ è¿‘å¹³åŒå¿—ä¸ºæ ¸å¿ƒçš„å…šä¸­å¤®åšå¼ºé¢†å¯¼ä¸‹ï¼Œåœ¨å…¨å›½äººå¤§åŠå…¶å¸¸å§”ä¼šæœ‰åŠ›ç›‘ç£ä¸‹ï¼Œå…¨å›½æ£€å¯Ÿæœºå…³ç´§ç´§å›´ç»•ç»æµç¤¾ä¼šå‘å±•å¤§å±€ï¼Œæ·±å…¥è´¯å½»æ°‘äº‹è¯‰è®¼æ³•ï¼Œå¿ å®å±¥è¡Œå¯¹æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨çš„æ³•å¾‹ç›‘ç£èŒè´£ï¼ŒåŠªåŠ›ç»´æŠ¤å¸æ³•å…¬æ­£å’Œæƒå¨ï¼Œè®©äººæ°‘ç¾¤ä¼—åœ¨æ¯ä¸€ä¸ªæ°‘äº‹æ£€å¯Ÿç›‘ç£æ¡ˆä»¶ä¸­æ„Ÿå—åˆ°å…¬å¹³æ­£ä¹‰ã€‚ \n" +
                "ä¸€ã€å‡†ç¡®æŠŠæ¡äººæ°‘ç¾¤ä¼—æ—¥ç›Šå¢é•¿çš„å¸æ³•éœ€æ±‚ï¼Œæ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨æ³•å¾‹ç›‘ç£å–å¾—ç§¯æè¿›å±• \n" +
                "æ°‘äº‹è¯‰è®¼å’Œæ‰§è¡Œæ´»åŠ¨äº‹å…³äººæ°‘ç¾¤ä¼—åˆ‡èº«åˆ©ç›Šï¼Œæ¡ˆä»¶é‡å¤§ã€æ¶‰åŠé¢å¹¿ã€‚æ°‘äº‹æ£€å¯Ÿå·¥ä½œåœ¨åŒ–è§£çŸ›ç›¾çº çº·ã€ç»´æŠ¤ç¤¾ä¼šç¨³å®šã€ä¿ƒè¿›ç»æµå‘å±•ç­‰æ–¹é¢å…·æœ‰ä¸å¯æ›¿ä»£çš„ä½œç”¨ã€‚ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰è¿›å…¥æ–°æ—¶ä»£ï¼Œæˆ‘å›½ç¤¾ä¼šä¸»è¦çŸ›ç›¾è½¬åŒ–ï¼Œäººæ°‘ç¾¤ä¼—å¯¹æ°‘ä¸»ã€æ³•æ²»ã€å…¬å¹³ã€æ­£ä¹‰ã€å®‰å…¨ã€ç¯å¢ƒç­‰æ–¹é¢çš„æ›´é«˜éœ€æ±‚ï¼Œä¸ä»…ä½“ç°åœ¨åˆ‘äº‹æ¡ˆä»¶ä¸­ï¼Œè€Œä¸”æ›´å¤šä½“ç°åœ¨æ°‘äº‹æ¡ˆä»¶é‡Œã€‚è¿‘å¹´æ¥ï¼Œæ£€å¯Ÿæœºå…³å—ç†çš„æ°‘äº‹ç”³è¯‰ä¿¡è®¿æ¡ˆä»¶æŒç»­é«˜ä½è¿è¡Œï¼Œè¶…è¿‡åˆ‘äº‹ç”³è¯‰ä¿¡è®¿æ¡ˆä»¶é‡ï¼Œåœ¨ä¿¡è®¿æ¡ˆä»¶æ€»é‡ä¸­çš„å æ¯”ä¸Šå‡è¶‹åŠ¿æ˜æ˜¾ã€‚2013å¹´1æœˆè‡³2017å¹´12æœˆï¼Œå…¨å›½æ£€å¯Ÿæœºå…³å…±å—ç†æ¶‰æ³•æ¶‰è¯‰ä¿¡è®¿172ä¸‡ä»¶æ¬¡ï¼Œå…¶ä¸­æ°‘äº‹ç”³è¯‰ä¿¡è®¿65ä¸‡ä»¶æ¬¡ï¼Œå 37.8%ï¼›åˆ‘äº‹ç”³è¯‰ä¿¡è®¿59.7ä¸‡ä»¶æ¬¡ï¼Œå 34.7%ã€‚2018å¹´1æœˆè‡³9æœˆï¼Œå—ç†æ°‘äº‹ç”³è¯‰ä¿¡è®¿9.5ä¸‡ä»¶æ¬¡ï¼Œå å„ç±»æ¶‰æ³•æ¶‰è¯‰ä¿¡è®¿æ€»æ•°çš„40.4%ï¼Œæ¯”2012å¹´é«˜å‡º18.6ä¸ªç™¾åˆ†ç‚¹ã€‚ \n" +
                "å„çº§æ£€å¯Ÿæœºå…³ç‰¢è®°å®ªæ³•æ³•å¾‹èµ‹äºˆçš„èŒè´£ï¼Œé¡ºåº”äººæ°‘ç¾¤ä¼—æ–°æœŸå¾…ï¼ŒåšæŒä»¥å¸æ³•åŠæ¡ˆä¸ºä¸­å¿ƒï¼Œå…¨é¢åŠ å¼ºå¯¹ç”Ÿæ•ˆæ°‘äº‹è£åˆ¤ã€è°ƒè§£ä¹¦å’Œå®¡åˆ¤ã€æ‰§è¡Œæ´»åŠ¨çš„æ³•å¾‹ç›‘ç£ï¼Œæ„å»ºèµ·å¤šå…ƒåŒ–æ°‘äº‹æ£€å¯Ÿ"
        println(a.trim())
    }
}
